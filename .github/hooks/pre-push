#!/bin/bash
set -e

REPO_ROOT="$(git rev-parse --show-toplevel)"

CHANGED_PLUGINS=""
for plugin in hope product wordsmith founder career; do
  if git diff --name-only "@{push}..HEAD" 2>/dev/null | grep -q "^$plugin/"; then
    CHANGED_PLUGINS="$CHANGED_PLUGINS $plugin"
  elif git diff --name-only "origin/main..HEAD" 2>/dev/null | grep -q "^$plugin/"; then
    CHANGED_PLUGINS="$CHANGED_PLUGINS $plugin"
  fi
done

if [ -z "$CHANGED_PLUGINS" ]; then
  echo "✓ No plugin changes, skipping eval"
  exit 0
fi

echo "Running evals for:$CHANGED_PLUGINS"

cd "$REPO_ROOT"
for plugin in $CHANGED_PLUGINS; do
  bun run eval/run.ts "$plugin"
done

echo ""
echo "✓ All evals passed"
